<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magento to Medusa Migration Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container-fluid py-4">
        <header class="mb-4 pb-3 border-bottom d-flex justify-content-between align-items-center">
            <h2 class="mb-0"><i class="bi bi-arrow-left-right text-primary"></i> Migration Tool</h2>
            <div id="status-indicator" class="badge bg-secondary">Idle</div>
        </header>

        <div class="row g-4">
            <!-- Left Panel: Configuration -->
            <div class="col-lg-4">
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center" data-bs-toggle="collapse"
                        data-bs-target="#connections-body" style="cursor: pointer;">
                        <span class="fw-bold"><i class="bi bi-gear-wide-connected"></i> Connections</span>
                        <i class="bi bi-chevron-down"></i>
                    </div>
                    <div class="card-body collapse show" id="connections-body">
                        <!-- Magento Config -->
                        <h6 class="text-primary border-bottom pb-2">Magento 2 Source</h6>
                        <form id="magento-form" class="mb-3">
                            <div class="mb-2">
                                <label class="form-label small">Base URL</label>
                                <input type="text" class="form-control form-control-sm" name="base_url"
                                    placeholder="https://magento.test"
                                    value="{{ defaults.magento.get('BASE_URL', '') }}" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label small">Admin Username</label>
                                <input type="text" class="form-control form-control-sm" name="username"
                                    placeholder="admin" value="{{ defaults.magento.get('ADMIN_USERNAME', '') }}"
                                    required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label small">Admin Password</label>
                                <div class="input-group input-group-sm">
                                    <input type="password" class="form-control" name="password"
                                        value="{{ defaults.magento.get('ADMIN_PASSWORD', '') }}" required>
                                    <button class="btn btn-outline-secondary toggle-pass" type="button"><i
                                            class="bi bi-eye"></i></button>
                                </div>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" name="verify_ssl" id="mg_verify_ssl" {%
                                    if defaults.magento.get('VERIFY_SSL') %}checked{% endif %}>
                                <label class="form-check-label small" for="mg_verify_ssl">Verify SSL</label>
                            </div>
                            <button type="submit" class="btn btn-sm btn-outline-primary w-100" id="btn-test-magento">
                                <span class="spinner-border spinner-border-sm d-none" role="status"
                                    aria-hidden="true"></span>
                                Test & Save Magento
                            </button>
                        </form>

                        <!-- Medusa Config -->
                        <h6 class="text-success border-bottom pb-2 mt-4">Medusa Destination</h6>
                        <form id="medusa-form">
                            <div class="mb-2">
                                <label class="form-label small">Base URL</label>
                                <input type="text" class="form-control form-control-sm" name="base_url"
                                    placeholder="http://localhost:9000"
                                    value="{{ defaults.medusa.get('BASE_URL', '') }}" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label small">Email</label>
                                <input type="email" class="form-control form-control-sm" name="email"
                                    placeholder="admin@medusa-test.com" value="{{ defaults.medusa.get('EMAIL', '') }}"
                                    required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label small">Password</label>
                                <div class="input-group input-group-sm">
                                    <input type="password" class="form-control" name="password"
                                        value="{{ defaults.medusa.get('PASSWORD', '') }}" required>
                                    <button class="btn btn-outline-secondary toggle-pass" type="button"><i
                                            class="bi bi-eye"></i></button>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-sm btn-outline-success w-100" id="btn-test-medusa">
                                <span class="spinner-border spinner-border-sm d-none" role="status"
                                    aria-hidden="true"></span>
                                Test & Save Medusa
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header fw-bold"><i class="bi bi-sliders"></i> Filters & Options</div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label small mb-1">Entities to Sync</label>
                            <div class="d-flex flex-wrap gap-3">
                                <div class="form-check">
                                    <input class="form-check-input entity-check" type="checkbox" value="products"
                                        id="check_products" checked>
                                    <label class="form-check-label small" for="check_products">Products</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input entity-check" type="checkbox" value="categories"
                                        id="check_categories" checked>
                                    <label class="form-check-label small" for="check_categories">Categories</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input entity-check" type="checkbox" value="customers"
                                        id="check_customers" checked>
                                    <label class="form-check-label small" for="check_customers">Customers</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input entity-check" type="checkbox" value="orders"
                                        id="check_orders" checked>
                                    <label class="form-check-label small" for="check_orders">Orders</label>
                                </div>
                            </div>
                        </div>

                        <div class="input-group input-group-sm mb-2">
                            <span class="input-group-text">Limit</span>
                            <input type="number" class="form-control" id="opt_limit" value="0" min="0"
                                title="0 = unlimited">
                        </div>

                        <!-- Filter IDs -->
                        <div class="mb-2">
                            <label class="form-label small">Filter IDs (comma separated)</label>

                            <div class="input-group input-group-sm mb-1">
                                <span class="input-group-text" style="width: 85px;">Products</span>
                                <input type="text" class="form-control" id="ids_products" placeholder="IDs">
                                <button class="btn btn-outline-secondary btn-select" data-type="products"
                                    type="button">Select</button>
                            </div>
                            <div class="input-group input-group-sm mb-1">
                                <span class="input-group-text" style="width: 85px;">Categories</span>
                                <input type="text" class="form-control" id="ids_categories" placeholder="IDs">
                                <button class="btn btn-outline-secondary btn-select" data-type="categories"
                                    type="button">Select</button>
                            </div>
                            <div class="input-group input-group-sm mb-1">
                                <span class="input-group-text" style="width: 85px;">Customers</span>
                                <input type="text" class="form-control" id="ids_customers" placeholder="IDs">
                                <button class="btn btn-outline-secondary btn-select" data-type="customers"
                                    type="button">Select</button>
                            </div>
                            <div class="input-group input-group-sm mb-1">
                                <span class="input-group-text" style="width: 85px;">Orders</span>
                                <input type="text" class="form-control" id="ids_orders" placeholder="IDs">
                                <button class="btn btn-outline-secondary btn-select" data-type="orders"
                                    type="button">Select</button>
                            </div>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="opt_dry_run">
                            <label class="form-check-label small" for="opt_dry_run">Dry Run (No API Writes)</label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="opt_finalize" checked>
                            <label class="form-check-label small" for="opt_finalize">Finalize Orders</label>
                        </div>

                        <!-- Order Migration Options -->
                        <div class="border-top pt-3 mb-3">
                            <label class="form-label small mb-2 fw-bold">Order Migration Options</label>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="opt_migrate_invoices">
                                <label class="form-check-label small" for="opt_migrate_invoices">
                                    <i class="bi bi-receipt"></i> Migrate Invoices (metadata only)
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="opt_migrate_payments">
                                <label class="form-check-label small" for="opt_migrate_payments">
                                    <i class="bi bi-credit-card"></i> Migrate Payments (metadata only)
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="opt_rollback_finalize">
                                <label class="form-check-label small" for="opt_rollback_finalize">
                                    <i class="bi bi-arrow-counterclockwise"></i> Rollback on Finalize Fail
                                </label>
                            </div>
                        </div>

                        <!-- Delta Migration -->
                        <div class="border-top pt-3 mb-3">
                            <label class="form-label small mb-2 fw-bold">Delta Migration</label>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="opt_delta_migration">
                                <label class="form-check-label small" for="opt_delta_migration">
                                    Enable Delta Migration
                                </label>
                            </div>

                            <div class="input-group input-group-sm">
                                <span class="input-group-text">From Date</span>
                                <input type="text" class="form-control" id="opt_delta_from_date" 
                                    placeholder="YYYY-MM-DD HH:mm:ss" 
                                    title="Format: YYYY-MM-DD HH:mm:ss (e.g., 2024-01-01 00:00:00)">
                            </div>
                            <small class="text-muted">Only migrate orders updated after this date</small>
                        </div>

                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" id="btn-start">
                                <i class="bi bi-play-fill"></i> Start Migration
                            </button>
                            <button class="btn btn-danger d-none" id="btn-stop">
                                <i class="bi bi-stop-fill"></i> Stop
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Logs -->
            <div class="col-lg-8" style="position: sticky; top: 1rem; align-self: start;">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span class="fw-bold"><i class="bi bi-terminal"></i> Live Logs</span>
                        <button class="btn btn-sm btn-outline-secondary" id="btn-clear-log">Clear</button>
                    </div>
                    <div class="card-body p-0 bg-black">
                        <div id="log-container" class="p-3 font-monospace small"
                            style="height: 600px; overflow-y: auto; color: #d4d4d4;">
                            <div class="text-muted">Waiting for actions...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Selection Modal -->
    <div class="modal fade" id="selectionModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Select Items</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control mb-3" id="modal-search" placeholder="Search...">
                    <div id="modal-list" class="list-group">
                        <div class="text-center py-4"><span class="spinner-border"></span> Loading...</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-sm btn-secondary" id="modal-select-all">Select All</button>
                    <button class="btn btn-sm btn-outline-secondary" id="modal-deselect-all">Deselect All</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="modal-confirm">Confirm Selection</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>